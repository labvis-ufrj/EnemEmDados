<body>
	<head>
		<meta charset="UTF-8">
		<title>MÉDIAS ORDENADAS</title>
		<script src="../d3.v3.min.js"></script>
		<script type="text/javascript" src="editavel.js"></script>
		<script type="text/javascript" src="VisGeral.js"></script>
		<link href="../bootstrap.min.css" rel="stylesheet">
		<link href="../template.css" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="VisGeral.css"/>
	</head>
	<body>

	    <div class="container" align="middle">
		    <div class="header clearfix">
		    	<div class="links">
			        <nav>
			        	<ul class="nav nav-pills pull-left">
			        		<li class="li1" role="presentation" padding-top= "10px"><a href="../index.html"><p class="indice1">enem</p><p class="indice2">em_dados</p></a></li>
				            <li class="li2" role="presentation"><a href="../VisMapa/index.html">MÉDIAS POR REGIÃO</a></li>
				            <li class="li3 active" role="presentation"><a href="../VisGeral/index.html">MÉDIAS ORDENADAS</a></li>
			            	<li class="li4" role="presentation" ><a href="../VisIdade/index.html">PESSOAS/FAIXA ETÁRIA</a></li>
						</ul>
					</nav>
				</div>
				<div class="logos">
					<nav>
				        <ul class="nav nav-pills pull-right">
					        <li role="presentation"><a href="https://labvis.eba.ufrj.br/"><img src="../imgs/labvis.png" alt="Lab Vis"  height="50" border="0"></a></li>
					        <li role="presentation"><a href="https://ufrj.br/"><img src="../imgs/eba.png" alt="Eba" height="50" border="0"></a></li>
					        <li role="presentation"><a href="http://www.eba.ufrj.br/"><img src="../imgs/logo_ufrj.png" alt="UFRJ" height="50" border="0"></a></li>
				        </ul>
			        </nav> 
			    </div>
			</div>
    	</div>

		<div id="menus"></div>
		<div align="center" class="visualizacao"></div>
		<script type="text/javascript">

			var vis = d3.select("div.visualizacao").append("svg")
		         .attr("width", "100%")
		         .attr("height","90%");


/*
			  var tooltip = d3.select("body")
			      .append("div")
			      .style("fill", "grey")
			      .style("position", "absolute")
			      .style("z-index", "10")
			      .style("visibility", "hidden")
			      .text("a simple tooltip")
			      .style("font-size","15px");

*/
		    var dataset = [];
		    var quantScale;
		    //var stateScale2;
		    var stateScale;
		    var gradeScale;
		 
			var maxQuant = maxVal = minVal = minQuant = 0;

/*
		    vis.selectAll(".imagem")
		    	.data([0])
		    	.enter()
		    	.append("svg:image")
		    	.attr("class","imagem")
				.attr('x',window.innerWidth*.045)
				.attr('y',450)
				.attr('width',365* .6)
				.attr('height', 162*.6)
				.attr("xlink:href","./explicacao_geral.png");

*/

		var textoGroup = vis.selectAll(".textoGroup")
					.data([0])
					.enter()
					.append("g")
					.attr("class","textoG");

		var  texto = textoGroup.selectAll(".textinhoExplicacao")
					.data(textoVector)
					.enter()
					.append("text")
					.attr("class","textinhoExplicacao")
					.text(function(d, i){return d;})
					.attr("x", function(d, i) { return textinhoX; })
					.attr("y", function(d, i){ return textinhoY + 15*i;})




			d3.csv("tabelaVisGeral.csv",function(data){
				dataset = data ;

		vis.selectAll(".textinhoIndice")
			.data([0])
			.enter()
			.append("text")
			.attr("class", "textinhoIndice")
			.text("Organizar por")
			.attr("x", textinhoX)
			.attr("y", textinhoIndiceY);



			var reordenar = function(subject){
	          //console.log(subject);
	          	var dados = dataset;
				function compare2(a,b) {
					if (subject != "Estado"){
						if (Number(a[subject]) < Number(b[subject]))
						    return -1;
						else if (Number(a[subject]) > Number(b[subject]))
						    return 1;
						else 
						    return 0;
					}
				
					else{
						if (a["Estado"] < b["Estado"])
						    return -1;
						else if (a["Estado"] > b["Estado"])
						    return 1;
						else 
						    return 0;
							
					}
				}
				dados.sort(compare2);
				return dados;
			};
				function compare(a,b) {
				  if (a["Estado"] < b["Estado"])
				    return -1;
				  else if (a["Estado"] > b["Estado"])
				    return 1;
				  else 
				    return 0;
				}

				dataset.sort(compare);
				//console.log(dataset);
	      
			var prod = ["Estado",
	                    "Linguagens",
	                    "Humanas", 
	                    "Natureza",
	                    "Redacao",
	                    "Matematica"];

	        var traducao = {Matematica: "Matemática",
				            Linguagens: "Linguagens",
				            Humanas: "Humanas", 
				            Natureza: "Natureza",
				            Redacao: "Redação",
				        	Estado: "Estado"};



			menu = vis.append("g")
					.attr("class", "menu")
					.attr("transform", function (d,i) { return "translate(" + menuX +","+ menuY +")";});

			menu.selectAll(".selected")
				.data([0])
				.enter()
				.append("rect")
				.attr("class", "selected")
				.attr("width", menuBoxWidth)
				.attr("height", menuBoxHeigth);

			menu.selectAll(".options")
				.data(prod)
				.enter()
				.append("text")
				.text( function (d) { return "" + traducao[d]; })
		        .attr("x", function(d, i) { return 40; })
 		        .attr("y", function(d, i){ return i*espacoEntreMenus + 30;})
 		        .attr("class", "options")
 		        .on("click", function(d, i){
	 		       var dados = reordenar(d);
		           VisGeralUpdate(dados, d);
		           d3.selectAll(".options").style("font-weight","normal");
		           d3.select(this).style("font-weight","bold"); 	
				
				vis.selectAll(".selected")
					.transition()
					.attr("y", function(){ return i*espacoEntreMenus + menuBoxY;})
					.duration(1000);

 		        });



			var disciplinas = ["Linguagens",
	                    "Humanas", 
	                    "Natureza",
	                    "Redacao",
	                    "Matematica"];

		menu.selectAll(".grades")
				.data(prod)
				.enter()
				.append("text")
				.classed(function(d,i){return d;}, true)
				.text("")
		        .attr("x", function(d, i) { return menuBoxWidth - 70; })
 		        .attr("y", function(d, i){ return (i)*espacoEntreMenus + 30;})
 		        .attr("class", "grades");





	      	menu.selectAll(".dotLinguagens")
		      .data([0])
		      .enter()
		      .append("rect")
		      .attr("class", "dotLinguagens")
			  .attr("width", 10)
		      .attr("height", 10)
		      .attr("x", function(d, i) { return figuresX; })
		      .attr("y",function(d, i){ return 1*espacoEntreMenus + figuresY;}); 

		    menu.selectAll(".dotHumanas")
		      .data([0])
		      .enter()
		      .append("circle")
		      .attr("class", "dotHumanas")
		      .attr("r", 5)
		      .attr("cx", function(d, i) { return figuresX + 5; })
		      .attr("cy", function(d, i){ return 2*espacoEntreMenus + figuresY + 8/2;});  


		    menu.selectAll(".dotNatureza")
		      .data([0])
		      .enter()
		      .append("circle")
		      .attr("class", "dotNatureza")
		      .attr("r", 5)
		      .attr("cx", function(d, i) { return figuresX + 5; })
		      .attr("cy", function(d, i){ return 3*espacoEntreMenus + figuresY + 8/2;});   

	      	menu.selectAll(".dotMatematica")
		      .data([0])
		      .enter()
		      .append("rect")
		      .attr("class", "dotMatematica")
			  .attr("width", 10)
		      .attr("height", 10)
		      .attr("x", function(d, i) { return figuresX; })
		      .attr("y", function(d, i){ return 5*espacoEntreMenus + figuresY;});


			menu.selectAll(".dotRedacao")
		      .data([0])
		      .enter()
		      .append("polygon")
		      .attr("class", "dotRedacao")
		      .attr("points", function(d, i){
			    	var point = [];
			    	var lado = 10
			    	point[1] = (figuresX - lado/2 + lado/2) + ','
			    	point[2] = 4*espacoEntreMenus + figuresY + lado*1.85/2 + ' '
			    	point[3] = (figuresX + lado/2 + lado/2) + ','
			    	point[4] = (4*espacoEntreMenus + figuresY + lado*1.85/2) + ' '
			    	point[5] = (figuresX + lado/2) + ','
			    	point[6] = (4*espacoEntreMenus + figuresY - lado*1.85/2 + lado*1.85/2) + '' 
			    	
			    	
			    	
			    	var points = '';

			    	for (i = 1; i < point.length; i++) { 
					    points += point[i];
					}
			    	return points})

			var subjects = ["Matematica",
			                    "Linguagens",
			                    "Humanas", 
			                    "Natureza",
			                    "Redacao"];
			

		    var sub = 0;
				maxVal = minVal = Number(dataset[0][subjects[0]]);
			for (sub= 0; sub< subjects.length; sub++){
				for (indice = 0; indice < dataset.length ; indice++){
					if (Number(dataset[indice][subjects[sub]]) > maxVal){
						maxVal = Number(dataset[indice][subjects[sub]]);
					};
					if (Number(dataset[indice][subjects[sub]]) < minVal){
						minVal = Number(dataset[indice][subjects[sub]]);
					};
					if (Number(dataset[indice].quantidade) > maxQuant){
						maxQuant = Number(dataset[indice].quantidade);
					};
					if (Number(dataset[indice].quantidade) < minQuant){
						minQuant = Number(dataset[indice].quantidade);
					};
				};
			};
			
			gradeScale = d3.scale.linear()
			    .domain([minVal * 0.95, maxVal * 1.03])
			    .range([tamanhoy, 0]);

			stateScale = d3.scale.linear()
			    .domain([-1, dataset.length])
			    .range([0,tamanhox]);



			quantScale = d3.scale.linear()
			    .domain([0, maxQuant*1.05])
			    .range([tamanhoy, 0]);
	        
			vis.selectAll(".options")
				.filter(function(d){
		    				return d == "Estado";
		    				})
				.style("font-weight","bold");
				vis.selectAll(".selected")
					.attr("x", menuBoxX)
					.attr("y", function(d, i){  return i*espacoEntreMenus + menuBoxY;});



			menu.selectAll(".clickRect")
				.data(prod)
				.enter()
				.append("rect")
				.attr("class", "clickRect")
				.attr("width", menuBoxWidth)
				.attr("height", menuBoxHeigth)				
		        .attr("x", function(d, i) { return 40; })
 		        .attr("y", function(d, i){ return i*espacoEntreMenus + menuBoxY;})
 		        .on("click", function(d, i){
	 		       var dados = reordenar(d);
		           VisGeralUpdate(dados, d);
		           d3.selectAll(".options").style("font-weight","normal");
		           d3.selectAll(".options")
						.filter(function(e){
		    				return d == e;
		    				})
				   		.style("font-weight","bold");


					vis.selectAll(".selected")
						.transition()
						.attr("y", function(){ return i*espacoEntreMenus + menuBoxY;})
						.duration(1000);

 		        });




	        VisGeral();
	      });




		</script>
	</body>
</body>